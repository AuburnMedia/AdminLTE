{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<style>
  body {
    font-family: 'Source Sans Pro', -apple-system, Roboto, Helvetica, sans-serif;
  }
  
  .carbon-usage-stats .usage-amount h2 {
    font-weight: 600;
  }
  .goal-progress-container .goal-percentage {
    font-size: 3rem;
    color: #007bff;
  }
  .progress-circle {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    background: conic-gradient(#28a745 var(--progress), #e9ecef var(--progress));
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 1rem;
    position: relative;
  }
  .progress-circle::before {
    content: '';
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: white;
    position: absolute;
  }
  .progress-text {
    position: relative;
    z-index: 1;
    font-weight: bold;
    font-size: 1.2rem;
  }
  .user-info {
    background: linear-gradient(135deg, #28a745, #20c997);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.9rem;
  }

  .metric-card {
    border: none;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease;
  }
  
  .metric-card:hover {
    transform: translateY(-5px);
  }
  
  .chart-container {
    position: relative;
    height: 300px;
    margin: 1rem 0;
  }
</style>
{% endblock %}

{% block content %}
<!--begin::App Content Header-->
<div class="app-content-header">
  <div class="container-fluid">
    <div class="row">
      <div class="col-sm-6">
        <h3 class="mb-0">Detailed Information</h3>
      </div>
      <div class="col-sm-6">
        <ol class="breadcrumb float-sm-end">
          <li class="breadcrumb-item"><a href="{% url 'dashboard:index' %}">Home</a></li>
          <li class="breadcrumb-item active" aria-current="page">
            Detailed Information
          </li>
        </ol>
      </div>
    </div>
  </div>
</div>
<!--end::App Content Header-->

<!--begin::App Content-->
<div class="app-content">
  <div class="container-fluid">
    <!--begin::Charts Grid-->
    <div class="row mb-4">
      <div class="col-lg-6 mb-4">
        <div class="card metric-card">
          <div class="card-header">
            <h4 class="card-title mb-0">Carbon Emissions Over Time</h4>
          </div>
          <div class="card-body">
            <div class="chart-container">
              <canvas id="areaChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-6 mb-4">
        <div class="card metric-card">
          <div class="card-header">
            <h4 class="card-title mb-0">Monthly Comparison</h4>
          </div>
          <div class="card-body">
            <div class="chart-container">
              <canvas id="barChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-6 mb-4">
        <div class="card metric-card">
          <div class="card-header">
            <h4 class="card-title mb-0">Emissions by Source</h4>
          </div>
          <div class="card-body">
            <div class="chart-container">
              <canvas id="donutChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-6 mb-4">
        <div class="card metric-card">
          <div class="card-header">
            <h4 class="card-title mb-0">Activity Breakdown</h4>
          </div>
          <div class="card-body">
            <div class="chart-container">
              <canvas id="pieChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-6 mb-4">
        <div class="card metric-card">
          <div class="card-header">
            <h4 class="card-title mb-0">Energy Consumption Trend</h4>
          </div>
          <div class="card-body">
            <div class="chart-container">
              <canvas id="lineChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-6 mb-4">
        <div class="card metric-card">
          <div class="card-header">
            <h4 class="card-title mb-0">Energy Sources</h4>
          </div>
          <div class="card-body">
            <div class="chart-container">
              <canvas id="stackedBarChart"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!--end::Charts Grid-->
  </div>
</div>
<!--end::App Content-->
{% endblock %}

{% block extra_js %}
<!-- EcoTrack Data Model -->
<script src="{% static 'js/ecotrack-data.js' %}"></script>
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>

<script>
  // Get data from shared model
  const dataModel = window.EcoTrackData;

  // Area Chart
  const areaCtx = document.getElementById('areaChart').getContext('2d');
  new Chart(areaCtx, {
    type: 'line',
    data: dataModel.getAreaChartData(),
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: true }
      },
      scales: {
        y: { beginAtZero: true }
      }
    }
  });

  // Bar Chart
  const barCtx = document.getElementById('barChart').getContext('2d');
  new Chart(barCtx, {
    type: 'bar',
    data: dataModel.getBarChartData(),
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: true }
      },
      scales: {
        y: { beginAtZero: true }
      }
    }
  });

  // Donut Chart
  const donutCtx = document.getElementById('donutChart').getContext('2d');
  new Chart(donutCtx, {
    type: 'doughnut',
    data: dataModel.getDonutChartData(),
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { position: 'bottom' }
      }
    }
  });

  // Pie Chart
  const pieCtx = document.getElementById('pieChart').getContext('2d');
  new Chart(pieCtx, {
    type: 'pie',
    data: dataModel.getPieChartData(),
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { position: 'bottom' }
      }
    }
  });

  // Line Chart
  const lineCtx = document.getElementById('lineChart').getContext('2d');
  new Chart(lineCtx, {
    type: 'line',
    data: dataModel.getLineChartData(),
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: true }
      },
      scales: {
        y: { beginAtZero: true }
      }
    }
  });

  // Stacked Bar Chart
  const stackedBarCtx = document.getElementById('stackedBarChart').getContext('2d');
  new Chart(stackedBarCtx, {
    type: 'bar',
    data: dataModel.getStackedBarChartData(),
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: true }
      },
      scales: {
        y: { 
          beginAtZero: true,
          stacked: true
        },
        x: {
          stacked: true
        }
      }
    }
  });

  function logout() {
    sessionStorage.removeItem('ecotrack_user');
    window.location.href = "{% url 'dashboard:index' %}";
  }
</script>
{% endblock %}
