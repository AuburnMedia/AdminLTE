<!doctype html>
<html lang="en">
  <!--begin::Head-->
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>EcoTrack | Footprint Estimator</title>
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <!-- AdminLTE CSS -->
    <link rel="stylesheet" href="static/css/adminlte.min.css">
    
    <style>
      .checkup-header {
        background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        padding: 2rem 0;
        border-bottom: 1px solid #dee2e6;
      }

      .form-section {
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 1.5rem;
        overflow: hidden;
      }

      .form-section-header {
        background: linear-gradient(135deg, #ffc107, #ffb300);
        color: #212529;
        padding: 1rem 1.5rem;
        font-weight: 600;
        border-bottom: 1px solid #e9ecef;
      }

      .form-section-body {
        padding: 1.5rem;
      }

      .question-group {
        margin-bottom: 2rem;
        padding-bottom: 1.5rem;
        border-bottom: 1px solid #f1f3f4;
      }

      .question-group:last-child {
        border-bottom: none;
        margin-bottom: 0;
      }

      .question-label {
        font-weight: 600;
        color: #495057;
        margin-bottom: 1rem;
        display: block;
      }

      .form-control:focus {
        border-color: #28a745;
        box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25);
      }

      .form-select:focus {
        border-color: #28a745;
        box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25);
      }

      .form-check-input:checked {
        background-color: #28a745;
        border-color: #28a745;
      }

      .form-check-input:focus {
        border-color: #28a745;
        box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25);
      }

      .input-success {
        border-color: #28a745;
        background-color: #f8fff9;
      }

      .input-warning {
        border-color: #ffc107;
        background-color: #fffef8;
      }

      .input-error {
        border-color: #dc3545;
        background-color: #fff8f8;
      }

      .validation-icon {
        position: absolute;
        right: 0.75rem;
        top: 50%;
        transform: translateY(-50%);
        z-index: 3;
      }

      .input-group-validation {
        position: relative;
      }

      .calculate-btn {
        background: linear-gradient(135deg, #28a745, #20c997);
        border: none;
        padding: 1rem 3rem;
        border-radius: 25px;
        color: white;
        font-weight: 600;
        font-size: 1.1rem;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
      }

      .calculate-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(40, 167, 69, 0.4);
        background: linear-gradient(135deg, #218838, #1e7e34);
      }

      .results-section {
        background: linear-gradient(135deg, #e8f5e8, #f8fff8);
        border-radius: 15px;
        padding: 2rem;
        margin-top: 2rem;
        border: 2px solid #28a745;
        display: none;
      }

      .results-display {
        text-align: center;
        margin-bottom: 2rem;
      }

      .co2-score {
        font-size: 3rem;
        font-weight: bold;
        color: #28a745;
        margin-bottom: 0.5rem;
      }

      .co2-label {
        color: #6c757d;
        font-size: 1.1rem;
      }

      .breakdown-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem 0;
        border-bottom: 1px solid rgba(40, 167, 69, 0.1);
      }

      .breakdown-item:last-child {
        border-bottom: none;
      }

      .breakdown-category {
        font-weight: 500;
        color: #495057;
      }

      .breakdown-value {
        font-weight: bold;
        color: #28a745;
      }

      .reset-btn {
        background: #6c757d;
        border: none;
        padding: 0.75rem 2rem;
        border-radius: 20px;
        color: white;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .reset-btn:hover {
        background: #5a6268;
        transform: translateY(-1px);
      }

      @media (max-width: 768px) {
        .form-section-body {
          padding: 1rem;
        }
        
        .calculate-btn {
          padding: 0.875rem 2rem;
          font-size: 1rem;
        }
        
        .co2-score {
          font-size: 2.5rem;
        }
      }
    </style>
  </head>
  <!--end::Head-->
  <!--begin::Body-->
  <body class="layout-fixed sidebar-expand-lg bg-body-tertiary">
    <!--begin::App Wrapper-->
    <div class="app-wrapper">
      <!-- Topbar -->
      <nav class="app-header navbar navbar-expand bg-body">
        <div class="container-fluid">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" data-lte-toggle="sidebar" href="#" role="button">
                <i class="bi bi-list"></i>
              </a>
            </li>
            <li class="nav-item d-none d-md-block">
              <a href="index.html" class="nav-link">Home</a>
            </li>
          </ul>
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link" href="#" role="button">
                <i class="bi bi-search"></i>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#" data-lte-toggle="fullscreen">
                <i data-lte-icon="maximize" class="bi bi-arrows-fullscreen"></i>
                <i data-lte-icon="minimize" class="bi bi-fullscreen-exit" style="display: none;"></i>
              </a>
            </li>
            <li class="nav-item">
              <span class="user-info" id="userInfo" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.9rem;">
                <i class="bi bi-person-circle me-1"></i>
                <span id="userName">Guest</span>
              </span>
            </li>
            <li class="nav-item">
              <a class="nav-link text-danger" href="#" onclick="logout()" title="Logout">
                <i class="bi bi-box-arrow-right"></i>
              </a>
            </li>
          </ul>
        </div>
      </nav>
      
      <!-- Sidebar -->
      <aside class="app-sidebar bg-body-secondary shadow" data-bs-theme="dark">
        <div class="sidebar-brand">
          <a href="index.html" class="brand-link">
            <div class="brand-image d-flex align-items-center justify-content-center">
              <i class="bi bi-leaf text-success" style="font-size: 2rem;"></i>
            </div>
            <span class="brand-text fw-light">EcoTrack</span>
          </a>
        </div>
        <div class="sidebar-wrapper">
          <nav class="mt-2">
            <ul class="nav sidebar-menu flex-column" data-lte-toggle="treeview" role="navigation">
              <li class="nav-item">
                <a href="index.html" class="nav-link">
                  <i class="nav-icon bi bi-speedometer"></i>
                  <p>Dashboard</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="checkup.html" class="nav-link">
                  <i class="nav-icon bi bi-calculator"></i>
                  <p>Calculate Footprint</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="detailed.html" class="nav-link">
                  <i class="nav-icon bi bi-info-circle"></i>
                  <p>Detailed Information</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="impact.html" class="nav-link">
                  <i class="nav-icon bi bi-lightning-fill"></i>
                  <p>Impact</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="reports.html" class="nav-link">
                  <i class="nav-icon bi bi-clipboard"></i>
                  <p>Your Reports</p>
                </a>
              </li>
            </ul>
          </nav>
        </div>
      </aside>
      
      <!--begin::App Main-->
      <main class="app-main">
        <!--begin::App Content Header-->
        <div class="app-content-header">
          <div class="container-fluid">
            <div class="row">
              <div class="col-sm-6">
                <h3 class="mb-0">Footprint Estimator</h3>
              </div>
              <div class="col-sm-6">
                <ol class="breadcrumb float-sm-end">
                  <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                  <li class="breadcrumb-item active" aria-current="page">
                    Checkup
                  </li>
                </ol>
              </div>
            </div>
          </div>
        </div>
        <!--end::App Content Header-->
        
        <!--begin::App Content-->
        <div class="app-content">
          <div class="container-fluid">
            <!--begin::Survey Form-->
            <form id="checkupForm">
              <div class="row">
                <!--begin::Left Column-->
                <div class="col-lg-6">
                  <div class="form-section">
                    <div class="form-section-header">Household Information</div>
                    <div class="form-section-body">
                      <!--begin::Question 1-->
                      <div class="question-group">
                        <label class="question-label">How many people live in your household?</label>
                        <select class="form-select" id="q1" required>
                          <option value="">Select household size</option>
                          <option value="1">1 person</option>
                          <option value="2">2-3 people</option>
                          <option value="3">4-5 people</option>
                          <option value="4">6+ people</option>
                        </select>
                      </div>

                      <!--begin::Question 2-->
                      <div class="question-group">
                        <label class="question-label">What type of home do you live in?</label>
                        <div class="row">
                          <div class="col-md-4">
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="q2" id="q2_1" value="apartment">
                              <label class="form-check-label" for="q2_1">Apartment</label>
                            </div>
                          </div>
                          <div class="col-md-4">
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="q2" id="q2_2" value="semi">
                              <label class="form-check-label" for="q2_2">Semi-detached</label>
                            </div>
                          </div>
                          <div class="col-md-4">
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="q2" id="q2_3" value="detached">
                              <label class="form-check-label" for="q2_3">Detached</label>
                            </div>
                          </div>
                        </div>
                      </div>

                      <!--begin::Question 3-->
                      <div class="question-group">
                        <label class="question-label">How is your home heated?</label>
                        <select class="form-select" id="q3" required>
                          <option value="">Select heating type</option>
                          <option value="electric">Electric</option>
                          <option value="gas">Gas</option>
                          <option value="oil">Oil</option>
                          <option value="none">None</option>
                        </select>
                      </div>

                      <!--begin::Question 4-->
                      <div class="question-group">
                        <label class="question-label">How often do you use high-energy appliances (washer, dryer, dishwasher)?</label>
                        <div class="input-group-validation">
                          <select class="form-select input-success" id="q4" required>
                            <option value="">Select frequency</option>
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="occasionally">Occasionally</option>
                            <option value="never">Never</option>
                          </select>
                          <i class="bi bi-check-circle text-success validation-icon"></i>
                        </div>
                      </div>

                      <!--begin::Question 5-->
                      <div class="question-group">
                        <label class="question-label">What type of lighting do you mostly use?</label>
                        <div class="input-group-validation">
                          <select class="form-select input-warning" id="q5" required>
                            <option value="">Select lighting type</option>
                            <option value="led">LED</option>
                            <option value="cfl">CFL</option>
                            <option value="incandescent">Incandescent</option>
                            <option value="mixed">Mixed</option>
                          </select>
                          <i class="bi bi-exclamation-triangle text-warning validation-icon"></i>
                        </div>
                      </div>

                      <!--begin::Question 6-->
                      <div class="question-group">
                        <label class="question-label">Do you use air conditioning?</label>
                        <div class="row">
                          <div class="col-md-6">
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="q6" id="q6_1" value="yes">
                              <label class="form-check-label" for="q6_1">Yes</label>
                            </div>
                          </div>
                          <div class="col-md-6">
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="q6" id="q6_2" value="no">
                              <label class="form-check-label" for="q6_2">No</label>
                            </div>
                          </div>
                        </div>
                      </div>

                      <!--begin::Question 7-->
                      <div class="question-group">
                        <label class="question-label">What type of car do you use most often?</label>
                        <div class="input-group-validation">
                          <select class="form-select input-error" id="q7" required>
                            <option value="">Select car type</option>
                            <option value="none">None / Don't drive</option>
                            <option value="petrol">Petrol</option>
                            <option value="diesel">Diesel</option>
                            <option value="hybrid">Hybrid</option>
                            <option value="electric">Electric</option>
                          </select>
                          <i class="bi bi-x-circle text-danger validation-icon"></i>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <!--end::Left Column-->

                <!--begin::Right Column-->
                <div class="col-lg-6">
                  <div class="form-section">
                    <div class="form-section-header">Lifestyle & Energy Usage</div>
                    <div class="form-section-body">
                      <!--begin::Question 8-->
                      <div class="question-group">
                        <label class="question-label">Average daily hours of device use (TV, PC, consoles)?</label>
                        <select class="form-select" id="q8" required>
                          <option value="">Select daily hours</option>
                          <option value="<2h">&lt;2 hours</option>
                          <option value="2-4h">2-4 hours</option>
                          <option value="4-8h">4-8 hours</option>
                          <option value="8+h">8+ hours</option>
                        </select>
                      </div>

                      <!--begin::Question 9-->
                      <div class="question-group">
                        <label class="question-label">What % of your electricity is renewable?</label>
                        <select class="form-select" id="q9" required>
                          <option value="">Select renewable percentage</option>
                          <option value="0">0%</option>
                          <option value="25">25%</option>
                          <option value="50">50%</option>
                          <option value="75">75%</option>
                          <option value="100">100%</option>
                        </select>
                      </div>

                      <!--begin::Question 10-->
                      <div class="question-group">
                        <label class="question-label">How often do you fly each year?</label>
                        <select class="form-select" id="q10" required>
                          <option value="">Select flight frequency</option>
                          <option value="never">Never</option>
                          <option value="1short">1 short flight</option>
                          <option value="2-4short">2-4 short flights</option>
                          <option value="1long">1 long flight</option>
                          <option value="multiple">Multiple long flights</option>
                        </select>
                      </div>

                      <!--begin::Question 11-->
                      <div class="question-group">
                        <label class="question-label">Do you use public transport regularly?</label>
                        <div class="row">
                          <div class="col-md-3">
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="q11" id="q11_1" value="never">
                              <label class="form-check-label" for="q11_1">Never</label>
                            </div>
                          </div>
                          <div class="col-md-3">
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="q11" id="q11_2" value="occasionally">
                              <label class="form-check-label" for="q11_2">Occasionally</label>
                            </div>
                          </div>
                          <div class="col-md-3">
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="q11" id="q11_3" value="weekly">
                              <label class="form-check-label" for="q11_3">Weekly</label>
                            </div>
                          </div>
                          <div class="col-md-3">
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="q11" id="q11_4" value="daily">
                              <label class="form-check-label" for="q11_4">Daily</label>
                            </div>
                          </div>
                        </div>
                      </div>

                      <!--begin::Question 12-->
                      <div class="question-group">
                        <label class="question-label">Do you compost your food waste?</label>
                        <div class="row">
                          <div class="col-md-6">
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="q12" id="q12_1" value="yes">
                              <label class="form-check-label" for="q12_1">Yes</label>
                            </div>
                          </div>
                          <div class="col-md-6">
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="q12" id="q12_2" value="no">
                              <label class="form-check-label" for="q12_2">No</label>
                            </div>
                          </div>
                        </div>
                      </div>

                      <!--begin::Question 13-->
                      <div class="question-group">
                        <label class="question-label">Do you line dry clothes instead of a dryer?</label>
                        <div class="row">
                          <div class="col-md-4">
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="q13" id="q13_1" value="always">
                              <label class="form-check-label" for="q13_1">Always</label>
                            </div>
                          </div>
                          <div class="col-md-4">
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="q13" id="q13_2" value="sometimes">
                              <label class="form-check-label" for="q13_2">Sometimes</label>
                            </div>
                          </div>
                          <div class="col-md-4">
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="q13" id="q13_3" value="never">
                              <label class="form-check-label" for="q13_3">Never</label>
                            </div>
                          </div>
                        </div>
                      </div>

                      <!--begin::Question 14-->
                      <div class="question-group">
                        <label class="question-label">Do you shop second-hand for clothes/furniture?</label>
                        <div class="row">
                          <div class="col-md-3">
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="q14" id="q14_1" value="often">
                              <label class="form-check-label" for="q14_1">Often</label>
                            </div>
                          </div>
                          <div class="col-md-3">
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="q14" id="q14_2" value="sometimes">
                              <label class="form-check-label" for="q14_2">Sometimes</label>
                            </div>
                          </div>
                          <div class="col-md-3">
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="q14" id="q14_3" value="rarely">
                              <label class="form-check-label" for="q14_3">Rarely</label>
                            </div>
                          </div>
                          <div class="col-md-3">
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="q14" id="q14_4" value="never">
                              <label class="form-check-label" for="q14_4">Never</label>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <!--end::Right Column-->
              </div>

              <!--begin::Calculate Button-->
              <div class="text-center mt-4">
                <button type="submit" class="btn calculate-btn">
                  <i class="bi bi-calculator me-2"></i>Calculate My Footprint
                </button>
              </div>
              <!--end::Calculate Button-->
            </form>
            <!--end::Survey Form-->

            <!--begin::Results Section-->
            <div class="results-section" id="resultsSection">
              <div class="results-display">
                <div class="co2-score" id="co2Score">0.0</div>
                <div class="co2-label">kg CO₂ per month per person</div>
              </div>
              
              <div class="row">
                <div class="col-lg-6">
                  <h5>Breakdown by Category</h5>
                  <div id="breakdownList">
                    <!-- Breakdown items will be inserted here -->
                  </div>
                </div>
                <div class="col-lg-6">
                  <h5>Annual Impact</h5>
                  <div class="breakdown-item">
                    <span class="breakdown-category">Annual CO₂ Emissions</span>
                    <span class="breakdown-value" id="annualCO2">0.0 tonnes</span>
                  </div>
                  <div class="breakdown-item">
                    <span class="breakdown-category">Trees Needed to Offset</span>
                    <span class="breakdown-value" id="treesNeeded">0 trees</span>
                  </div>
                  <div class="breakdown-item">
                    <span class="breakdown-category">Comparison to Global Average</span>
                    <span class="breakdown-value" id="globalComparison">--</span>
                  </div>
                </div>
              </div>

              <div class="text-center mt-3">
                <button type="button" class="btn reset-btn me-3" onclick="resetForm()">
                  <i class="bi bi-arrow-clockwise me-2"></i>Take Survey Again
                </button>
                <button type="button" class="btn calculate-btn" onclick="saveResults()">
                  <i class="bi bi-bookmark me-2"></i>Save Results
                </button>
              </div>
            </div>
            <!--end::Results Section-->
          </div>
        </div>
        <!--end::App Content-->
      </main>
      <!--end::App Main-->
      
      <!-- Footer -->
      <footer class="app-footer">
        <div class="float-end d-none d-sm-inline">EcoTrack Carbon Dashboard</div>
        <strong>Copyright &copy; 2024 EcoTrack.</strong> All rights reserved.
      </footer>
    </div>
    <!--end::App Wrapper-->
    
    <!--begin::Script-->
    <!-- Bootstrap Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- AdminLTE JS -->
    <script src="static/js/adminlte.min.js"></script>
    
    <!-- EcoTrack Data Model -->
    <script src="static/js/ecotrack-data.js"></script>

    <script>
      // CO2 calculation weights based on provided table
      const co2Weights = {
        q1: { 1: 1, 2: 2.5, 3: 4.5, 4: 6 }, // Household size (divisor)
        q2: { apartment: 100, semi: 150, detached: 200 }, // Home type
        q3: { electric: 150, gas: 250, oil: 350, none: 0 }, // Heating
        q4: { daily: 50, weekly: 20, occasionally: 10, never: 0 }, // Appliances
        q5: { led: 5, cfl: 15, incandescent: 40, mixed: 25 }, // Lighting
        q6: { yes: 80, no: 0 }, // Air conditioning
        q7: { none: 0, petrol: 300, diesel: 320, hybrid: 150, electric: 60 }, // Car type
        q8: { '<2h': 10, '2-4h': 20, '4-8h': 40, '8+h': 60 }, // Device usage
        q9: { 0: 0, 25: 0.25, 50: 0.5, 75: 0.75, 100: 1.0 }, // Renewable %
        q10: { never: 0, '1short': 100, '2-4short': 200, '1long': 600, multiple: 1200 }, // Flying
        q11: { never: 0, occasionally: -20, weekly: -50, daily: -80 }, // Public transport
        q12: { yes: -10, no: 0 }, // Composting
        q13: { always: -15, sometimes: -5, never: 0 }, // Line drying
        q14: { often: -20, sometimes: -10, rarely: -5, never: 0 } // Second-hand shopping
      };

      // Electric categories for renewable discount
      const electricCategories = ['q3', 'q4', 'q5', 'q6', 'q8'];

      // Check authentication on page load
      window.addEventListener('load', function() {
        const user = sessionStorage.getItem('ecotrack_user');
        if (!user) {
          window.location.href = 'login.html';
          return;
        }

        const userObj = JSON.parse(user);
        const userData = window.EcoTrackData.getUser();
        document.getElementById('userName').textContent = userData.name;
      });

      function logout() {
        sessionStorage.removeItem('ecotrack_user');
        window.location.href = 'login.html';
      }

      // Form submission handler
      document.getElementById('checkupForm').addEventListener('submit', function(e) {
        e.preventDefault();
        calculateFootprint();
      });

      function calculateFootprint() {
        let totalCO2 = 0;
        let breakdown = {};
        let householdSize = 1;

        // Get all form values
        const formData = new FormData(document.getElementById('checkupForm'));
        const answers = {};

        // Collect all answers
        for (let i = 1; i <= 14; i++) {
          const questionId = `q${i}`;
          let value;
          
          if (i === 1 || i === 3 || i === 4 || i === 5 || i === 7 || i === 8 || i === 9 || i === 10) {
            // Select dropdowns
            value = document.getElementById(questionId).value;
          } else {
            // Radio buttons
            const radio = document.querySelector(`input[name="${questionId}"]:checked`);
            value = radio ? radio.value : null;
          }
          
          answers[questionId] = value;
        }

        // Validate all questions are answered
        for (let i = 1; i <= 14; i++) {
          if (!answers[`q${i}`] || answers[`q${i}`] === '') {
            alert(`Please answer question ${i} before calculating your footprint.`);
            return;
          }
        }

        // Get household size for final division
        householdSize = co2Weights.q1[answers.q1] || 1;

        // Calculate emissions for each category
        let homeEmissions = 0;
        let electricEmissions = 0;

        // Q2: Home type
        const homeType = co2Weights.q2[answers.q2] || 0;
        homeEmissions += homeType;
        breakdown['Home Type'] = homeType;

        // Q3: Heating
        const heating = co2Weights.q3[answers.q3] || 0;
        if (answers.q3 === 'electric') {
          electricEmissions += heating;
        } else {
          homeEmissions += heating;
        }
        breakdown['Heating'] = heating;

        // Q4: Appliances
        const appliances = co2Weights.q4[answers.q4] || 0;
        electricEmissions += appliances;
        breakdown['Appliances'] = appliances;

        // Q5: Lighting
        const lighting = co2Weights.q5[answers.q5] || 0;
        electricEmissions += lighting;
        breakdown['Lighting'] = lighting;

        // Q6: Air conditioning
        const aircon = co2Weights.q6[answers.q6] || 0;
        electricEmissions += aircon;
        breakdown['Air Conditioning'] = aircon;

        // Q7: Car
        const car = co2Weights.q7[answers.q7] || 0;
        totalCO2 += car;
        breakdown['Transportation'] = car;

        // Q8: Device usage
        const devices = co2Weights.q8[answers.q8] || 0;
        electricEmissions += devices;
        breakdown['Electronic Devices'] = devices;

        // Apply renewable discount to electric emissions
        const renewablePercent = co2Weights.q9[answers.q9] || 0;
        const renewableDiscount = electricEmissions * renewablePercent;
        electricEmissions -= renewableDiscount;
        breakdown['Renewable Savings'] = -renewableDiscount;

        // Add electric emissions to total
        totalCO2 += homeEmissions + electricEmissions;

        // Q10: Flying
        const flying = co2Weights.q10[answers.q10] || 0;
        totalCO2 += flying;
        breakdown['Air Travel'] = flying;

        // Q11: Public transport (reduction)
        const publicTransport = co2Weights.q11[answers.q11] || 0;
        totalCO2 += publicTransport;
        breakdown['Public Transport'] = publicTransport;

        // Q12: Composting (reduction)
        const composting = co2Weights.q12[answers.q12] || 0;
        totalCO2 += composting;
        breakdown['Composting'] = composting;

        // Q13: Line drying (reduction)
        const lineDrying = co2Weights.q13[answers.q13] || 0;
        totalCO2 += lineDrying;
        breakdown['Line Drying'] = lineDrying;

        // Q14: Second-hand shopping (reduction)
        const secondHand = co2Weights.q14[answers.q14] || 0;
        totalCO2 += secondHand;
        breakdown['Second-hand Shopping'] = secondHand;

        // Calculate per-person footprint
        const perPersonCO2 = totalCO2 / householdSize;

        // Display results
        displayResults(perPersonCO2, breakdown, householdSize);
      }

      function displayResults(perPersonCO2, breakdown, householdSize) {
        // Update main CO2 score
        document.getElementById('co2Score').textContent = perPersonCO2.toFixed(1);

        // Calculate annual emissions
        const annualCO2 = (perPersonCO2 * 12) / 1000; // Convert to tonnes
        document.getElementById('annualCO2').textContent = annualCO2.toFixed(2) + ' tonnes';

        // Calculate trees needed (1 tree absorbs ~22kg CO2 per year)
        const treesNeeded = Math.ceil((perPersonCO2 * 12) / 22);
        document.getElementById('treesNeeded').textContent = treesNeeded + ' trees';

        // Global comparison (global average is ~4 tonnes per person per year)
        const globalAverage = 4000; // kg per year
        const userAnnual = perPersonCO2 * 12;
        const comparisonPercent = ((userAnnual / globalAverage) * 100).toFixed(0);
        document.getElementById('globalComparison').textContent = comparisonPercent + '% of global avg';

        // Create breakdown list
        const breakdownList = document.getElementById('breakdownList');
        breakdownList.innerHTML = '';
        
        Object.entries(breakdown)
          .filter(([key, value]) => Math.abs(value) > 0.1) // Only show significant values
          .sort(([,a], [,b]) => Math.abs(b) - Math.abs(a)) // Sort by magnitude
          .forEach(([category, value]) => {
            const item = document.createElement('div');
            item.className = 'breakdown-item';
            item.innerHTML = `
              <span class="breakdown-category">${category}</span>
              <span class="breakdown-value" style="color: ${value >= 0 ? '#dc3545' : '#28a745'}">
                ${value >= 0 ? '+' : ''}${value.toFixed(1)} kg
              </span>
            `;
            breakdownList.appendChild(item);
          });

        // Show results section
        document.getElementById('resultsSection').style.display = 'block';
        
        // Scroll to results
        document.getElementById('resultsSection').scrollIntoView({ 
          behavior: 'smooth',
          block: 'start'
        });
      }

      function resetForm() {
        document.getElementById('checkupForm').reset();
        document.getElementById('resultsSection').style.display = 'none';
        
        // Scroll to top of form
        document.querySelector('.app-content-header').scrollIntoView({ 
          behavior: 'smooth',
          block: 'start'
        });
      }

      function saveResults() {
        const co2Score = document.getElementById('co2Score').textContent;
        const annualCO2 = document.getElementById('annualCO2').textContent;
        
        // Save to data model
        if (window.EcoTrackData) {
          const currentDate = new Date().toISOString().split('T')[0];
          const entry = {
            date: currentDate,
            carbon: parseFloat(annualCO2),
            change: 0,
            activity: 'Footprint Assessment'
          };
          
          window.EcoTrackData.addHistoryEntry(entry);
          
          // Update annual goal current value
          window.EcoTrackData.updateAnnualGoal(window.EcoTrackData.getAnnualGoal().target);
        }
        
        alert(`Your carbon footprint of ${co2Score} kg CO₂/month (${annualCO2}/year) has been saved to your profile!`);
      }
    </script>
    <!--end::Script-->
  </body><!--end::Body-->
</html>
